---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProjectCard from '../../components/ProjectCard.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.id },
    props: project,
  }));
}

const project = Astro.props;
const { Content } = await render(project);

const formattedDate = project.data.pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
});

// Get related projects
const allProjects = await getCollection('projects', (p) => p.id !== project.id);
const relatedProjects = allProjects.slice(0, 2);
---

<BaseLayout title={`${project.data.title} | Case Study`} description={project.data.description} ogId={project.id}>
  <article class="project-case-study">
    <div class="container">
      <header class="project-header">
        <a href="/projects" class="back-link">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
          Back to Projects
        </a>
        <h1 class="project-title">{project.data.title}</h1>
        <p class="project-subtitle">{project.data.description}</p>
        
        <div class="project-meta">
          <div class="meta-item">
            <span class="meta-label">Date</span>
            <span class="meta-value">{formattedDate}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Tags</span>
            <div class="meta-tags">
              {project.data.tags.map((tag: string) => (
                <span class="project-tag">{tag}</span>
              ))}
            </div>
          </div>
        </div>

        <div class="project-links">
          {project.data.github && (
            <a href={project.data.github} target="_blank" rel="noopener noreferrer" class="btn btn-outline">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
              GitHub
            </a>
          )}
          {project.data.live && (
            <a href={project.data.live} target="_blank" rel="noopener noreferrer" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>
              Live Demo
            </a>
          )}
        </div>
      </header>

      <div class="project-content">
        <Content />
      </div>

      <footer class="project-footer">
        <a href="/projects" class="btn btn-outline">View More Projects</a>
      </footer>

      {relatedProjects.length > 0 && (
        <section class="related-projects reveal">
          <h2 class="related-title">Explore More Projects</h2>
          <div class="related-grid">
            {relatedProjects.map((p) => (
              <ProjectCard
                title={p.data.title}
                description={p.data.description}
                tags={p.data.tags}
                github={p.data.github}
                live={p.data.live}
                slug={p.id}
              />
            ))}
          </div>
        </section>
      )}
    </div>
  </article>
</BaseLayout>

<style>
  .project-case-study {
    padding-top: 8rem;
    padding-bottom: 5rem;
  }

  .project-header {
    margin-bottom: 4rem;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.9rem;
    color: var(--color-text-muted);
    margin-bottom: 2rem;
    transition: color var(--transition);
  }

  .back-link:hover {
    color: var(--color-primary);
  }

  .project-title {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #fff, var(--color-text));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .project-subtitle {
    font-size: clamp(1.1rem, 2vw, 1.4rem);
    color: var(--color-text-muted);
    max-width: 800px;
    margin-bottom: 2.5rem;
    line-height: 1.6;
  }

  .project-meta {
    display: flex;
    gap: 3rem;
    margin-bottom: 2.5rem;
    flex-wrap: wrap;
  }

  .meta-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .meta-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--color-primary);
  }

  .meta-value {
    color: var(--color-text);
    font-weight: 500;
  }

  .meta-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .project-tag {
    font-size: 0.8rem;
    padding: 0.15rem 0.6rem;
    border-radius: 4px;
    background: rgba(124, 58, 237, 0.1);
    color: var(--color-accent-light);
    border: 1px solid rgba(124, 58, 237, 0.2);
  }

  .project-links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .project-content {
    max-width: 800px;
    line-height: 1.8;
    color: var(--color-text-muted);
  }

  .project-content :global(h2) {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--color-text);
    margin: 3rem 0 1.5rem;
  }

  .project-content :global(p) {
    margin-bottom: 1.5rem;
  }

  .project-content :global(ul) {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  .project-content :global(li) {
    margin-bottom: 0.5rem;
    list-style: disc;
  }

  .project-content :global(li)::marker {
    color: var(--color-primary);
  }

  .project-footer {
    margin-top: 5rem;
    padding-top: 3rem;
    border-top: 1px solid var(--color-border);
    text-align: center;
    margin-bottom: 5rem;
  }

  .related-projects {
    padding-top: 3rem;
    border-top: 1px solid var(--color-border);
  }

  .related-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 2rem;
    background: linear-gradient(135deg, var(--color-gradient-start), var(--color-gradient-end));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(340px, 100%), 1fr));
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .project-case-study {
      padding-top: 6rem;
    }

    .project-meta {
      gap: 1.5rem;
    }
  }
</style>
