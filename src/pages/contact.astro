---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getLangFromUrl, useTranslations, getLocalizedPath } from '../i18n/index';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<BaseLayout title={`${t('contact.title')} | Manthan Ankolekar`} description={t('contact.subtitle')}>
  <section class="section contact-hero">
    <div class="container">
      <h1 class="section-title">{t('contact.title')}</h1>
      <p class="section-subtitle">{t('contact.subtitle')}</p>
    </div>
  </section>

  <section class="container contact-section">
    <div class="contact-grid">
      <div class="contact-info">
        <h2>{t('contact.letsConnect')}</h2>
        <p>
          {t('contact.connectDesc')}
        </p>

        <div class="contact-methods">
          <a href="mailto:manthan.ank46@gmail.com" class="contact-method">
            <div class="method-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
            </div>
            <div class="method-details">
              <span class="method-label">Email</span>
              <span class="method-value">manthan.ank46@gmail.com</span>
            </div>
          </a>

          <a href="https://github.com/manthanank" target="_blank" rel="noopener noreferrer" class="contact-method">
            <div class="method-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
            </div>
            <div class="method-details">
              <span class="method-label">GitHub</span>
              <span class="method-value">github.com/manthanank</span>
            </div>
          </a>

          <a href="https://linkedin.com/in/manthanank" target="_blank" rel="noopener noreferrer" class="contact-method">
            <div class="method-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>
            </div>
            <div class="method-details">
              <span class="method-label">LinkedIn</span>
              <span class="method-value">linkedin.com/in/manthanank</span>
            </div>
          </a>

          <a href="https://x.com/manthan_ank" target="_blank" rel="noopener noreferrer" class="contact-method">
            <div class="method-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </div>
            <div class="method-details">
              <span class="method-label">X</span>
              <span class="method-value">@manthan_ank</span>
            </div>
          </a>
        </div>
      </div>

      <div class="contact-form-wrapper"
        data-sending={t('contact.sending')}
        data-sent={t('contact.sent')}
        data-thanks={t('contact.thanks')}
        data-send-another={t('contact.sendAnother')}
        data-error={t('contact.error')}
        data-send={t('contact.send')}
      >
        <form class="contact-form" id="contact-form" name="contact" method="POST" data-netlify="true" data-netlify-honeypot="bot-field">
          <input type="hidden" name="form-name" value="contact" />
          <p class="hidden" style="display:none">
            <label>Don’t fill this out if you’re human: <input name="bot-field" /></label>
          </p>
          <div class="form-group">
            <label for="name">{t('contact.name')}</label>
            <input type="text" id="name" name="name" required placeholder={t('contact.placeholderName')} />
          </div>
          <div class="form-group">
            <label for="email">{t('contact.email')}</label>
            <input type="email" id="email" name="email" required placeholder={t('contact.placeholderEmail')} />
          </div>
          <div class="form-group">
            <label for="subject">{t('contact.subject')}</label>
            <input type="text" id="subject" name="subject" required placeholder={t('contact.placeholderSubject')} />
          </div>
          <div class="form-group">
            <label for="message">{t('contact.message')}</label>
            <textarea id="message" name="message" rows="5" required placeholder={t('contact.placeholderMessage')}></textarea>
          </div>
          <div id="form-status" class="form-status"></div>
          <button type="submit" class="btn btn-primary submit-btn btn-magnetic" id="submit-btn" data-labelsent={t('contact.sent')}>
            {t('contact.send')}
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
          </button>
          <p class="form-note">
            {t('contact.formNote')}
            <a href="mailto:manthan.ank46@gmail.com">manthan.ank46@gmail.com</a>.
          </p>
        </form>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  import confetti from 'canvas-confetti';

  const form = document.getElementById('contact-form') as HTMLFormElement;
  const statusEl = document.getElementById('form-status');
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const formWrapper = document.querySelector('.contact-form-wrapper') as HTMLElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const sendingText = formWrapper.dataset.sending || 'Sending...';
    const sentText = formWrapper.dataset.sent || 'Message Sent!';
    const thanksText = formWrapper.dataset.thanks || 'Thanks for reaching out!';
    const sendAnotherText = formWrapper.dataset.sendAnother || 'Send Another';
    const errorText = formWrapper.dataset.error || 'Something went wrong.';
    const sendText = formWrapper.dataset.send || 'Send Message';

    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.innerHTML = sendingText;
    }

    if (statusEl) {
      statusEl.textContent = '';
      statusEl.className = 'form-status';
    }

    const formData = new FormData(form);
    
    try {
      const response = await fetch("/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(formData as any).toString(),
      });

      if (response.ok) {
        confetti({
          particleCount: 150,
          spread: 70,
          origin: { y: 0.6 },
          colors: ['#00d4ff', '#7c3aed', '#ffffff']
        });

        if (formWrapper) {
          formWrapper.innerHTML = `
            <div class="success-state animate-fade-in" style="text-align: center; padding: 3rem 1rem;">
              <div class="success-icon" style="margin-bottom: 1.5rem; color: #22c55e;">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
              </div>
              <h3 style="font-size: 1.75rem; margin-bottom: 1rem;">${sentText}</h3>
              <p style="color: var(--color-text-muted); margin-bottom: 2rem; line-height: 1.6;">${thanksText}</p>
              <button onclick="location.reload()" class="btn btn-outline">${sendAnotherText}</button>
            </div>
          `;
        }
      } else {
        throw new Error('Form submission failed');
      }
    } catch (error) {
      if (statusEl) {
        statusEl.textContent = errorText;
        statusEl.classList.add('error');
      }
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = `
          ${sendText}
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
        `;
      }
    }
  });
</script>

<style>
  .contact-hero {
    padding-top: 8rem;
    padding-bottom: 0;
  }

  .contact-section {
    padding-bottom: 5rem;
  }

  .contact-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: start;
  }

  .contact-info h2 {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--color-text);
  }

  .contact-info > p {
    color: var(--color-text-muted);
    line-height: 1.8;
    margin-bottom: 2rem;
  }

  .contact-methods {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .contact-method {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    transition: all var(--transition);
    color: var(--color-text);
  }

  .contact-method:hover {
    border-color: var(--color-primary);
    transform: translateX(5px);
    color: var(--color-text);
  }

  .method-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: rgba(0, 212, 255, 0.08);
    border-radius: 10px;
    color: var(--color-primary);
    flex-shrink: 0;
  }

  .method-details {
    display: flex;
    flex-direction: column;
  }

  .method-label {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    font-weight: 500;
  }

  .method-value {
    font-weight: 600;
    font-size: 0.95rem;
  }

  /* Form */
  .contact-form-wrapper {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    padding: 2rem;
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .form-group label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--color-text);
  }

  .form-group input,
  .form-group textarea {
    padding: 0.75rem 1rem;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    color: var(--color-text);
    font-family: var(--font-sans);
    font-size: 0.95rem;
    transition: border-color var(--transition);
    outline: none;
  }

  .form-group input::placeholder,
  .form-group textarea::placeholder {
    color: var(--color-text-muted);
    opacity: 0.6;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 120px;
  }

  .form-status {
    font-size: 0.9rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    display: none;
  }

  .form-status.success {
    display: block;
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.2);
  }

  .form-status.error {
    display: block;
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  .submit-btn {
    width: 100%;
    justify-content: center;
    margin-top: 0.5rem;
  }

  .form-note {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    text-align: center;
    margin-top: 0.5rem;
    line-height: 1.5;
  }

  .form-note a {
    color: var(--color-primary);
  }

  @media (max-width: 768px) {
    .contact-hero {
      padding-top: 6rem;
    }

    .contact-grid {
      grid-template-columns: 1fr;
      gap: 2.5rem;
    }

    .method-value {
      font-size: 0.85rem;
      word-break: break-all;
    }
  }

  @media (max-width: 480px) {
    .contact-form-wrapper {
      padding: 1.25rem;
    }
  }
</style>
